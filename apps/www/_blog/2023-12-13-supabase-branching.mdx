---
title: 'Supabase Branching'
description: 'A Postgres database for every Pull Request.'
launchweek: X
categories:
  - product
tags:
  - launch-week
  - supavisor
  - postgres
date: '2023-12-13'
published_at: '2023-12-13:00:00.000-09:00'
toc_depth: 3
author: qiao,jonny
image: lwx-supabase-branching/branching-og.png
thumb: lwx-supabase-branching/branching-thumb.png
---

A few months ago we mentioned that we were working on Branching with a (somewhat ambitious) early-access form.

Today we are rolling out access to early-access subscribers. Internally, we were hoping to make this public access for this Launch Week but, well, [_we did say this was hard_](/blog/supabase-local-dev#supabase-branching-is-hard).

We're operating on a first-signed-up, first-served basis, rolling it out in batches to paid orgs in who registered for early access.

<Img
  src={{
    light: '/images/blog/lwx-supabase-branching/branching-ui--light.png',
    dark: '/images/blog/lwx-supabase-branching/branching-ui--dark.png',
  }}
  wide={true}
  caption="New Branching UI in the Supabase dashboard"
  captionAlign="left"
/>

## What's Branching?

At some point during development, you will probably need to experiment with your Postgres database. Today that's possible on your local development machine using the Supabase CLI. When you run `supabase start` with the CLI to get the entire Supabase stack running locally. You can play around with ideas and run `supabase db reset` whenever you want to start again. When you want to capture your changes in a database migration, you can run `supabase db diff`.

Branching is a natural extension of this, but instead of experimenting with a just a _local_ database you also get _remote_ database. You continue to use the workflow above, and then when you commit your changes to Git we'll run them on a Supabase Preview Branch.

<Img
  alt="Tweet showing Guillermo Rauch mentioning Supabase as one of the companies compatible with the Next.js App Router"
  src={{
    light: '/images/blog/lwx-supabase-branching/feat-branches-examples--light.png',
    dark: '/images/blog/lwx-supabase-branching/feat-branches-examples--dark.png',
  }}
  caption="Each Git branch has a corresponding Supabase Preview."
  captionAlign="left"
/>

Each Git branch has a corresponding Supabase Preview, which automatically updates whenever you push an update. The rest of the workflow should feel familiar: when you merge a Pull Request into your main Git branch, Supabase will run your database migrations inside your Production database.

Your project's Preview Branches are designed with safety in mind. They are isolated instances, each with a distinct set of API keys and passwords. Each instance contains every Supabase feature: a Postgres database, Auth, File Storage, Realtime, Edge Functions, and Data APIs.

<Img
  alt="Tweet showing Guillermo Rauch mentioning Supabase as one of the companies compatible with the Next.js App Router"
  src={{
    light: '/images/blog/lwx-supabase-branching/isolated-instances--light.png',
    dark: '/images/blog/lwx-supabase-branching/isolated-instances--dark.png',
  }}
  caption="Every Supabase Preview is a dedicated instance, with a full suite of Supabase services."
  captionAlign="left"
/>

Even in relaxed developer environments, if one of your team accidentally leak a key it won't affect your Production branch.

### Support for Vercel Previews

We've designed Supabase Branching to work perfectly with Vercel's [Preview](https://vercel.com/features/previews) deployments. This means that you get an _entire stack_ with Branching. 

<Img
  alt="Tweet showing Guillermo Rauch mentioning Supabase as one of the companies compatible with the Next.js App Router"
  src={{
    light: '/images/blog/lwx-supabase-branching/vercel-support--light.png',
    dark: '/images/blog/lwx-supabase-branching/vercel-support--dark.png',
  }}
  caption=""
  captionAlign="left"
/>

We've made several improvements to our [Vercel Integration](https://vercel.com/integrations/supabase-v2) to make the Vercel experience seamless. For example, since we provide distinct, secure database credentials for every Supabase Preview Branch, we automatically populate the environment variables on Vercel with the connection secrets your app needs to connect to the Preview Branch.

<Img
  alt="Tweet showing Guillermo Rauch mentioning Supabase as one of the companies compatible with the Next.js App Router"
  src={{
    light: '/images/blog/lwx-supabase-branching/vercel-env-var-settings--light.png',
    dark: '/images/blog/lwx-supabase-branching/vercel-env-var-settings--dark.png',
  }}
  wide={true}
  captionAlign="left"
/>

### Developing on the hosted Preview Branch

One of the most-loved features of Supabase is the dashboard. Even if we [beg](/docs/guides/platform/maturity-model#in-production), it seems that developers simply want to use it for everything - even in production.

The cool thing about Branching is that every Supabase Preview can be managed from the Dashboard. You can make schema changes, access the SQL Editor, and use the [new AI Assistant](/blog/studio-introducing-assistant). Once you're happy with your changes, you simply run `supabase db diff` on your local maching to pull the changes and you can commit them to Git.

Just note that we _still_ want you to develop locally! You should treat the Preview Branches [like cattle, not pets](https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets). Your Preview changes can be wiped at any time if one of your team pushes a destructive migration.

### Database migrations

We've developed Branching to work with a Git provider, starting with GitHub. We've developed a GitHub app that watches for changes inside your connected GitHub repository.

When you open a Pull Request to your connected repo, the app will automatically launch a Preview Branch and apply the schema migrations in `./supabase/migrations` directory. Any errors from running the migrations will be logged to the [Check Run](https://docs.github.com/en/rest/checks/runs?apiVersion=2022-11-28) associated with that git commit. When all checks turn green, your new Preview Branch is ready to use.

When you push a new migration file to the Git branch, the app will run it incrementally on your existing Preview Branch. This allows you verify schema changes easily on existing seed data.

Finally, when you merge that PR, the app will run all newly merged migrations on your Production environment. If you have other PRs already open, make sure to update those migration files to a later timestamp than the ones in Production branch. Other than this being easy, it's worth stressing that you are then following a [standard migration practice](https://supabase.com/docs/guides/cli/managing-environments).

### Data seeding

You can seed your Preview branch in the same way that you [seed your local development environment](https://supabase.com/docs/guides/cli/seeding-your-database). Just add `./supabase/seed.sql` in your repo and the seed script will run when the Preview Branch is first created.

Optionally, you can reset your branch database by running `supabase db reset --db-url <branch-connection-string>`. The branch connection string can be retrieved using your Personal Access Token with Supabase CLI's [branch management](https://supabase.com/docs/reference/cli/supabase-branches-get) commands.

In the future we'll investigate data masking techniques with a copy-on-write system so that you can emulate a production workload inside your Preview Branches (we plan for this to work with File Storage too).

<Admonition type="note" label="Testing with product workloads today?">

If you need to test with production workloads today, check out [Snaplet](https://www.snaplet.dev/) and [Postgres.ai](http://Postgres.ai). Both are great partners of Supabase.

</Admonition>

## Future considerations

That's already a lot for Branching v0. Branching will be a core part of the developer workflow in the future. These are the themes we'll explore next:

### Migration queues

We'll give you more visibility into the schedules of the migration runner. This will be useful for debugging. The first step here is simply showing which Preview Branches are queued and actively running. This is our first priority.

### Declarative config

We're still working on “configuration in code”. For example, you might want to try a different Google Auth in your Preview Branch than the one you use in Product. This would be a lot easier if the code was declarative, inside the [config.toml](https://supabase.com/docs/guides/cli/config) file.

### Automatic dashboard commits

In the current version, when you use the dashboard to create a change on a Preview Branch, you need to run `db diff` locally to pull that change into your Git repository. That will change. We will work on a feature to automatically capture your changes in a Git repo that you've connected.

### Extended seeding behavior

There are a multitude of different strategies for populating seed data. We've dabbled with AI to generate a seed data, which was fun. We also like the approach of [postgresql-anonymizer](https://postgresql-anonymizer.readthedocs.io/en/stable/) and [Snaplet](https://docs.snaplet.dev/recipes/supabase), who specialize in cloning production data while anonymizing the data for safe development.

### Copy-on-write

We have something in development :). CoW means you can branch from database snapshot and then run tests on “production-like” workloads. This is the approach that [Postgres.ai](http://Postgres.ai) uses. As we mention above, we need this feature to extend our File Storage product. We are in the process of upgrading all the tools with the right primitives to enable CoW.

### GitHub action templates

Once our GitHub app integration is matured, we will expose all the same logic in GitHub action templates so you can manage and design your own CI/CD pipeline. All of the same API routes that the GitHub app integration uses will be public for you and your team to use.

### Auto deploy functions

Edge functions could auto deploy to your Preview branches on git push events. It's worth also mentioning that support for deploying Edge functions to non-Branching Supabase projects is also being investigated; this would be an alternative to manually adding GitHub actions.

## Interested in using Branching?

We still have our early access form open, and we'll be consistently onboarding new organizations over the next few days and weeks.

It's important to note, that we highly recommend you should not use Branching for any of your applications that are in production.

You can check out the docs for Branching and also if you have any feedback, [you can join the discussion here](https://github.com/orgs/supabase/discussions/18937).
