import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  title: 'Email templates',
  description: 'Learn how to configure the email templates on Supabase',
}

Supabase offers the capability to customize the default email messages that are sent out during authentication flows via its email templating system.
The following email templates are available for editting:

- Confirm signup
- Invite user
- Magic Link
- Change Email Address
- Reset Password

## Terminology

The templating system provides the following variables for use:

| Name                     | Description                                                                                                                                                                                                       |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `{{ .ConfirmationURL }}` | Contains the confirmation url. For example, a signup confirmation url would look like: `https://project-ref.supabase.co/auth/v1/verify?token={{ .TokenHash }}&type=signup&redirect_to=https://example.com/path` . |
| `{{ .Token }}`           | Contains a 6-digit One-Time-Password (OTP) that can be used instead of the `{{. ConfirmationURL }}` .                                                                                                             |
| `{{ .TokenHash }}`       | Contains a hashed version of the `{{ .Token }}`. This is useful for constructing your own email link in the email template.                                                                                       |
| `{{ .SiteURL }}`         | Contains your application's site URL. This can be configured in your project's authentication settings.                                                                                                           |

## Limitations

### Email Prefetching

Certain email providers might have spam detection or other security features that prefetch URL links in emails received.
In this scenario, the `{{ .ConfirmationURL }}` sent will be consumed instantly which will lead to a "Token has expired or is invalid" error.

These are some measures you can consider to guard against this:

1. Use an email OTP instead by including `{{ .Token }}` in the email template.
2. Create your own custom email link to redirect the user to a page where they can click on a button to confirm the action.
   For example, you can include the following in your email template:

```html
<a href="{{ .SiteURL }}/confirm-signup?confirmation_url={{ .ConfirmationURL }}"
  >Confirm your signup
</a>
```

The user should be brought to a page on your site where they can confirm the action through clicking a button.
The button should contain the actual confirmation link which can be obtained from parsing the query parameter (`confirmation_url={{ .ConfirmationURL }}`) in the url.

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
