---
title: Sharding and Partitioning
subtitle: 'Store partitions in multiple Supabase projects to scale horizontally'
---

In this guide, we will cover how to use [postgres_fdw](/docs/guides/database/extensions/postgres_fdw) to link two Supabase projects, set up sharding, and partition tables so that partitions are stored on different shards. We will also discuss how to move partitions between shards and query individual partitions as well as the parent table.

This guide covers some advanced Postgresql topics that are already covered in the Supabase documentation, make sure to read through the documentation on [partitioning](/docs/guides/database/partitions) and [sharding](docs/guides/database/sharding) first.

## Setting up sharding and partitioning

To set up sharding and partitioning, you can partition your tables and store each partition on a different shard.

### Creating partitioned tables on different shards

1. **Create the partitioned table**:

   ```sql
   CREATE TABLE sales (
       id BIGINT GENERATED BY DEFAULT AS IDENTITY,
       order_date DATE NOT NULL,
       customer_id BIGINT,
       amount BIGINT,
       PRIMARY KEY (order_date, id)
   )
   PARTITION BY RANGE (order_date);
   ```

2. **Create partitions on different shards**:

   ```sql
   CREATE FOREIGN TABLE sales_2000_01
   PARTITION OF sales
   FOR VALUES FROM ('2000-01-01') TO ('2000-02-01')
   SERVER shard1 OPTIONS (table_name 'sales_2000_01');

   CREATE FOREIGN TABLE sales_2000_02
   PARTITION OF sales
   FOR VALUES FROM ('2000-02-01') TO ('2000-03-01')
   SERVER shard2 OPTIONS (table_name 'sales_2000_02');
   ```

## Moving partitions between shards

To move a partition from one shard to another, you can use the following steps:

1. **Detach the partition from the parent table**:

   ```sql
   ALTER TABLE sales DETACH PARTITION sales_2000_02;
   ```

2. **Create the foreign table on the new shard**:

   ```sql
   CREATE FOREIGN TABLE sales_2000_02_new
   PARTITION OF sales
   FOR VALUES FROM ('2000-02-01') TO ('2000-03-01')
   SERVER shard1 OPTIONS (table_name 'sales_2000_02');
   ```

3. **Attach the new partition to the parent table**:

   ```sql
   ALTER TABLE sales ATTACH PARTITION sales_2000_02_new FOR VALUES FROM ('2000-02-01') TO ('2000-03-01');
   ```

## Querying partitioned tables

You can query partitioned tables by querying the parent table or specific partitions.

### Querying the parent table

When you query the parent table, Postgres automatically routes the query to the relevant partitions based on the conditions specified in the query.

```sql
select *
from sales
where order_date >= '2000-01-01' and order_date < '2000-03-01';
```

### Querying specific partitions

If you only need to retrieve data from a specific partition, you can directly query that partition.

```sql
select *
from sales_2000_02;
```

By following these steps, you can effectively use sharding and partitioning to distribute your data across multiple Supabase project, improving performance and scalability.
